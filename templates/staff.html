{% extends "base.html" %}
{% set title = "Staff" %}
{% block content %}
<h1>ðŸ“‹ Orders</h1>
<p>Enter staff key to view orders (default: <code>canteen123</code>).</p>
<input type="password" id="staffKey" placeholder="Staff Key">
<button onclick="saveKey()">Save</button>
<table class="table table-hover mt-3" id="ordersTable">
  <thead><tr><th>Time</th><th>Order #</th><th>Name</th><th>Class</th><th>Item</th><th>â‚¹</th></tr></thead>
  <tbody><tr><td colspan="6">No data</td></tr></tbody>
</table>

<script>
function getKey() { return localStorage.getItem('staffKey') || ''; }
function saveKey() { localStorage.setItem('staffKey', document.getElementById('staffKey').value); load(); }
async function load() {
  let key = getKey(); if (!key) return;
  let res = await fetch('/api/orders?key='+key);
  let tbody = document.querySelector('#ordersTable tbody');
  if (res.status == 401) { tbody.innerHTML = '<tr><td colspan=6>Wrong key</td></tr>'; return; }
  let data = await res.json();
  tbody.innerHTML = data.orders.map(o=>`
    <tr><td>${new Date(o.created_at).toLocaleString()}</td>
    <td>${o.order_number}</td><td>${o.student_name}</td>
    <td>${o.class_section}</td><td>${o.item_name}</td><td>${o.price}</td></tr>
  `).join('');
}
setInterval(load, 5000); load();
</script>
{% endblock %}
